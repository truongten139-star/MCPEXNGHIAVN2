<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MCPExNghia · Addons</title>
  <meta name="description" content="Trang danh sách addons Minecraft — giao diện tối, mượt và chuyên nghiệp" />
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">

  <style>
    /* ===== variables ===== */
    :root{
      --bg-1: #05000a;
      --bg-2: #0b0026;
      --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.02);
      --accent: linear-gradient(90deg,#8b5cf6,#f97316);
      --accent-solid: #8b5cf6;
      --muted: #cdb5ff;
      --white: #fff;
      --card-shadow: 0 10px 30px rgba(2,2,10,0.6);
      --radius: 14px;
      --glass-border: rgba(255,255,255,0.06);
      --glass-focus: rgba(139,92,246,0.12);
      --max-w: 1180px;
      --ease: cubic-bezier(.2,.9,.35,1);
    }

    /* ===== base ===== */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-1),#0b0312);color:var(--white);font-family:Inter, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    button{font-family:inherit}

    /* ===== container ===== */
    .site{
      max-width:var(--max-w);
      margin:28px auto;
      padding:20px;
      position:relative;
    }

    /* ===== header / nav ===== */
    header.site-header{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      padding:18px 20px;
      border-radius:16px;
      background:linear-gradient(90deg, rgba(139,92,246,0.12), rgba(249,115,22,0.06));
      box-shadow: 0 6px 30px rgba(11,4,30,0.6);
      backdrop-filter: blur(6px) saturate(120%);
      border:1px solid rgba(255,255,255,0.03);
    }
    .brand{display:flex;gap:12px;align-items:center}
    .logo{
      width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#7c3aed,#fb923c);display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:18px;box-shadow:0 6px 18px rgba(139,92,246,0.18)
    }
    .brand h1{margin:0;font-size:18px;letter-spacing:0.6px}
    nav.main-nav{display:flex;gap:10px;align-items:center}
    .nav-link{padding:8px 12px;border-radius:10px;color:var(--muted);font-weight:600}
    .nav-link:hover{background:rgba(255,255,255,0.02);color:var(--white)}

    /* ===== top actions ===== */
    .controls{display:flex;gap:12px;align-items:center}
    .search{
      display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;background:var(--glass);border:1px solid var(--glass-border);box-shadow:inset 0 1px 0 rgba(255,255,255,0.02)
    }
    .search input{
      border:0;background:transparent;color:var(--white);outline:none;width:360px;max-width:36vw;font-size:14px;
    }
    .chip{padding:8px 12px;border-radius:999px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);font-weight:700;color:var(--muted)}
    .btn-primary{padding:10px 14px;border-radius:12px;border:0;background:var(--accent-solid);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 8px 24px rgba(139,92,246,0.14);transition:transform .15s var(--ease)}
    .btn-primary:hover{transform:translateY(-3px)}
    .btn-ghost{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);cursor:pointer}

    /* ===== layout ===== */
    .layout{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:20px;
      margin-top:20px;
    }
    @media (max-width:1100px){ .layout{grid-template-columns:1fr 320px} }
    @media (max-width:900px){ .layout{grid-template-columns:1fr} .controls .search input{width:42vw} }

    /* ===== left: grid of cards ===== */
    .cards{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
      gap:18px;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:16px;padding:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:var(--card-shadow);overflow:hidden;transition:transform .18s var(--ease),box-shadow .18s var(--ease);
      display:flex;flex-direction:column;gap:8px;
    }
    .card:hover{transform:translateY(-6px);box-shadow:0 22px 60px rgba(3,3,12,0.7)}
    .card .thumb{width:100%;height:150px;border-radius:12px;background:#0b0018;overflow:hidden;display:block}
    .card .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .card h3{margin:0;font-size:16px;color:var(--white)}
    .card p{margin:0;color:#d9c0ff;font-size:13px;line-height:1.3;height:40px;overflow:hidden}
    .card .meta{display:flex;align-items:center;justify-content:space-between;margin-top:auto;gap:8px}
    .badge{padding:6px 8px;border-radius:8px;font-weight:700;background:linear-gradient(90deg,#ffb86b,#ff7ab6);color:#000;font-size:13px}

    /* ===== right sidebar ===== */
    aside.side{
      position:relative;padding:16px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);
      height:fit-content;
    }
    .side h4{margin:0 0 12px 0}
    .filters{display:flex;flex-direction:column;gap:10px}
    .filter-row{display:flex;gap:8px;flex-wrap:wrap}
    .toggle{padding:8px 10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;color:var(--muted);font-weight:700}
    .small{font-size:13px;color:var(--muted)}

    /* ===== panel modal details ===== */
    .panel{
      position:fixed;left:50%;top:8%;transform:translateX(-50%);width:92%;max-width:980px;background:linear-gradient(180deg,#0b0026,#2b0048);border-radius:18px;padding:18px;border:1px solid rgba(255,255,255,0.04);z-index:20000;box-shadow:0 40px 140px rgba(3,3,12,0.85);display:none;
    }
    .panel.open{display:block;animation:panelIn .28s var(--ease)}
    @keyframes panelIn{from{opacity:0;transform:translate(-50%, -6%)}to{opacity:1;transform:translate(-50%,0)}}
    .panel-grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
    .panel-img{width:100%;height:420px;border-radius:12px;overflow:hidden;background:#070015}
    .panel-img img{width:100%;height:100%;object-fit:cover}
    .panel .p-title{margin:0 0 6px 0;font-size:22px}
    .panel .p-desc{color:#e9dffb;margin:0;line-height:1.5}
    .panel .p-actions{display:flex;gap:10px;margin-top:14px}
    .panel .close{
      position:absolute;right:14px;top:14px;width:46px;height:46px;border-radius:10px;border:0;background:rgba(0,0,0,0.28);color:#fff;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center
    }

    /* ===== admin small UI ===== */
    .admin-mini{display:flex;gap:8px;align-items:center;margin-top:12px}
    .admin-mini input{padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--white)}
    .admin-panel{margin-top:12px;padding:12px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
    .note{font-size:13px;color:var(--muted);margin-top:8px}

    /* ===== footer ===== */
    footer{margin-top:26px;text-align:center;color:var(--muted);font-size:13px}

    /* small screens */
    @media (max-width:720px){
      .search input{width:60vw}
      .layout{grid-template-columns:1fr}
      aside.side{order:2}
      .panel-grid{grid-template-columns:1fr}
      .panel-img{height:220px}
    }
  </style>
</head>
<body>
  <div class="site">
    <header class="site-header">
      <div class="brand">
        <div class="logo">MC</div>
        <div>
          <h1>MCPExNghia</h1>
          <div style="font-size:12px;color:var(--muted)">Addons · Themes · Mods</div>
        </div>
      </div>

      <nav class="main-nav" aria-label="Chính">
        <a class="nav-link" href="#">Trang chủ</a>
        <a class="nav-link" href="#addons">Addons</a>
        <a class="nav-link" href="#contact">Liên hệ</a>
        <a class="nav-link" href="#about">Giới thiệu</a>
      </nav>

      <div class="controls">
        <div class="search" role="search" aria-label="Tìm addon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="rgba(255,255,255,0.7)" stroke-width="1.6" stroke-linecap="round"/></svg>
          <input id="q" type="search" placeholder="Tìm addon, ví dụ: horror, zombie" aria-label="Tìm addon">
        </div>
        <div class="chip">Tổng: <span id="count">0</span></div>
        <button id="btnNew" class="btn-primary" title="Thêm addon">Thêm Addon</button>
      </div>
    </header>

    <main class="layout" id="addons">
      <section>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
          <h2 style="margin:0">Addons nổi bật</h2>
          <div class="small">Sắp xếp: <select id="sort" style="background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px;border-radius:8px;color:var(--muted)">
            <option value="featured">Nổi bật trước</option>
            <option value="new">Mới nhất</option>
            <option value="name">Tên A→Z</option>
          </select></div>
        </div>

        <div class="cards" id="grid" aria-live="polite"></div>
        <div style="height:24px"></div>
        <footer id="bottomNote">Dùng GitHub raw URL nếu bạn đặt addons.json trong repo của mình.</footer>
      </section>

      <aside class="side" aria-labelledby="sideTitle">
        <h4 id="sideTitle">Bộ lọc & Quản lý</h4>

        <div class="filters">
          <div class="filter-row">
            <button class="toggle" data-filter="all">Tất cả</button>
            <button class="toggle" data-filter="featured">Nổi bật</button>
            <button class="toggle" data-filter="recent">Mới nhất</button>
          </div>

          <div style="margin-top:6px">
            <label class="small">Từ khóa</label>
            <input id="filterInput" placeholder="Tìm nhanh" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--white)">
          </div>

          <div style="margin-top:12px">
            <div class="small" style="margin-bottom:8px">Admin (cục bộ)</div>
            <div class="admin-mini">
              <input id="adminKey" type="password" placeholder="Admin key" aria-label="Admin key">
              <button id="btnAdminLogin" class="btn-ghost">Đăng nhập</button>
            </div>
            <div class="note">Đăng nhập cục bộ: key mặc định <strong>mcpexnghia2025</strong></div>
          </div>
        </div>

        <div class="admin-panel" id="adminPanel" style="display:none">
          <h4>Thêm nhanh</h4>
          <input id="aName" placeholder="Tên addon" style="width:100%;margin-top:8px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--white)">
          <input id="aImage" placeholder="Link ảnh (url)" style="width:100%;margin-top:8px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--white)">
          <input id="aDownload" placeholder="Link tải (url)" style="width:100%;margin-top:8px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--white)">
          <textarea id="aDesc" placeholder="Mô tả" rows="3" style="width:100%;margin-top:8px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--white)"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <label style="display:flex;align-items:center;gap:8px"><input id="aFeatured" type="checkbox">Nổi bật</label>
            <button id="btnAdd" class="btn-primary">Lưu</button>
          </div>
          <div class="note">Lưu trên trang hiện tại. Để ghi lên GitHub hoặc server, cần gọi API hoặc commit file.</div>
        </div>
      </aside>
    </main>

    <!-- Modal detail -->
    <div id="panel" class="panel" role="dialog" aria-modal="true" aria-labelledby="pTitle">
      <button id="panelClose" class="close" aria-label="Đóng">✕</button>
      <div class="panel-grid">
        <div class="panel-img" id="panelImgWrap"><img id="panelImg" src="" alt=""></div>
        <div>
          <h2 id="pTitle" class="p-title">Tên addon</h2>
          <p id="pDesc" class="p-desc">Mô tả</p>
          <div class="p-actions">
            <a id="pDownload" class="btn-primary" href="#" target="_blank" rel="noopener">Tải xuống</a>
            <button id="pCopy" class="btn-ghost">Sao chép link</button>
            <span id="pBadge" class="badge" style="margin-left:auto;display:inline-block">Nổi bật</span>
          </div>
          <div id="pMeta" style="margin-top:14px;color:var(--muted)"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ========== CONFIG ========== */
    // Thay USERNAME/REPO/BRANCH cho đúng repo của bạn
    const ADDONS_JSON_PATH = 'https://raw.githubusercontent.com/truongten139-star/MCPEXNGHIAVN2/main/addons.json';
    // Nếu bạn host index.html và addons.json cùng origin (GitHub Pages) có thể dùng './addons.json'

    /* ========== state ========== */
    let addons = [];
    let filtered = [];
    let isAdmin = false;

    /* ========== DOM refs ========== */
    const grid = document.getElementById('grid');
    const q = document.getElementById('q');
    const countEl = document.getElementById('count');
    const sortEl = document.getElementById('sort');
    const filterButtons = document.querySelectorAll('[data-filter]');
    const filterInput = document.getElementById('filterInput');

    const panel = document.getElementById('panel');
    const panelClose = document.getElementById('panelClose');
    const panelImg = document.getElementById('panelImg');
    const pTitle = document.getElementById('pTitle');
    const pDesc = document.getElementById('pDesc');
    const pDownload = document.getElementById('pDownload');
    const pBadge = document.getElementById('pBadge');
    const pMeta = document.getElementById('pMeta');
    const pCopy = document.getElementById('pCopy');

    const adminKey = document.getElementById('adminKey');
    const btnAdminLogin = document.getElementById('btnAdminLogin');
    const adminPanel = document.getElementById('adminPanel');
    const btnAdd = document.getElementById('btnAdd');
    const btnNew = document.getElementById('btnNew');

    // Add fields
    const aName = document.getElementById('aName');
    const aImage = document.getElementById('aImage');
    const aDesc = document.getElementById('aDesc');
    const aDownload = document.getElementById('aDownload');
    const aFeatured = document.getElementById('aFeatured');

    /* ========== helpers ========== */
    function el(tag, cls){ const e=document.createElement(tag); if(cls) e.className=cls; return e; }
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function formatDate(iso){ try{ return new Date(iso).toLocaleString('vi-VN'); }catch(e){return iso||'';} }

    /* ========== fetch data ========== */
    async function load(){
      try{
        const res = await fetch(ADDONS_JSON_PATH, {cache:'no-store'});
        if(!res.ok) throw new Error('Fetch failed ' + res.status);
        addons = await res.json();
        // normalize: ensure ids and createdAt exist
        addons = addons.map((a,i)=>({
          id: a.id || ('a'+(Date.now()+i)),
          name: a.name || 'No name',
          description: a.description || '',
          image: a.image || '',
          download: a.download || '#',
          featured: !!a.featured,
          createdAt: a.createdAt || new Date().toISOString()
        }));
        applyFilters();
      }catch(err){
        console.error(err);
        grid.innerHTML = '<div style="padding:18px;color:#f6e6ff">Không thể tải dữ liệu. Kiểm tra đường dẫn JSON hoặc CORS.</div>';
      }
    }

    /* ========== render ======== */
    function render(list){
      grid.innerHTML='';
      if(!list.length){ grid.innerHTML='<div style="padding:18px;color:#d6b3ff">Không tìm thấy addon</div>'; countEl.textContent=0; return; }
      countEl.textContent = list.length;
      list.forEach(item=>{
        const card = el('article','card');
        const thumb = el('div','thumb');
        thumb.innerHTML = `<img loading="lazy" src="${escapeHtml(item.image)}" alt="${escapeHtml(item.name)}">`;
        const h = el('h3'); h.textContent = item.name;
        const p = el('p'); p.textContent = item.description;
        const meta = el('div','meta');
        const a = el('a','link'); a.href = item.download; a.target='_blank'; a.rel='noopener'; a.textContent='Tải';
        const btn = el('div'); btn.style.display='flex';
        const det = el('button','btn-ghost'); det.textContent='Chi tiết';
        det.style.cursor='pointer';
        det.addEventListener('click', ()=> openPanel(item));
        btn.appendChild(det);

        // featured badge
        if(item.featured){
          const badge = el('div','badge'); badge.textContent='Nổi bật';
          meta.appendChild(badge);
        }

        meta.appendChild(a);
        meta.appendChild(btn);

        card.appendChild(thumb);
        card.appendChild(h);
        card.appendChild(p);
        card.appendChild(meta);

        grid.appendChild(card);
      });
    }

    /* ========== filters / sort ======== */
    function applyFilters(){
      const qv = (q.value||'').toLowerCase().trim();
      const f = (filterInput.value||'').toLowerCase().trim();
      const sortVal = sortEl ? sortEl.value : 'featured';
      filtered = addons.filter(a=>{
        if(qv && !(a.name.toLowerCase().includes(qv) || a.description.toLowerCase().includes(qv))) return false;
        if(f && !(a.name.toLowerCase().includes(f) || a.description.toLowerCase().includes(f))) return false;
        return true;
      });
      // sort
      if(sortVal==='featured'){
        filtered.sort((x,y)=> (y.featured - x.featured) || (new Date(y.createdAt) - new Date(x.createdAt)));
      } else if(sortVal==='new'){
        filtered.sort((x,y)=> new Date(y.createdAt) - new Date(x.createdAt));
      } else if(sortVal==='name'){
        filtered.sort((x,y)=> x.name.localeCompare(y.name,'vi'));
      }
      render(filtered);
    }

    /* ========== panel detail ======== */
    function openPanel(item){
      panelImg.src = item.image || '';
      pTitle.textContent = item.name;
      pDesc.textContent = item.description;
      pDownload.href = item.download || '#';
      pBadge.style.display = item.featured ? 'inline-block' : 'none';
      pMeta.textContent = 'Ngày: ' + formatDate(item.createdAt);
      panel.classList.add('open');
      // trap focus: focus close button
      panelClose.focus();
    }
    function closePanel(){ panel.classList.remove('open'); }

    panelClose.addEventListener('click', closePanel);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closePanel(); });

    pCopy.addEventListener('click', ()=>{
      const url = pDownload.href;
      navigator.clipboard?.writeText(url).then(()=> alert('Đã sao chép link tải'));
    });

    /* ========== admin (local) ======== */
    btnAdminLogin.addEventListener('click', ()=>{
      const val = adminKey.value || '';
      if(val === 'mcpexnghia2025'){
        isAdmin = true; adminPanel.style.display='block'; adminKey.value=''; alert('Đăng nhập admin thành công (cục bộ)');
      } else {
        alert('Sai key');
      }
    });

    btnAdd.addEventListener('click', ()=>{
      if(!isAdmin){ alert('Bạn chưa đăng nhập admin'); return; }
      const name = aName.value.trim(), desc=aDesc.value.trim(), img=aImage.value.trim(), dl=aDownload.value.trim();
      if(!name || !desc){ alert('Vui lòng điền tên và mô tả'); return; }
      const item = { id: 'a'+Date.now(), name, description: desc, image: img, download: dl||'#', featured: !!aFeatured.checked, createdAt: new Date().toISOString() };
      addons.unshift(item);
      applyFilters();
      aName.value=''; aDesc.value=''; aImage.value=''; aDownload.value=''; aFeatured.checked=false;
      alert('Đã thêm (chỉ lưu cục bộ trên trang). Để lưu vĩnh viễn, commit lên GitHub hoặc dùng API server.');
    });

    btnNew.addEventListener('click', ()=>{
      // quick open add form (toggle admin panel)
      if(isAdmin){
        adminPanel.style.display = adminPanel.style.display === 'block' ? 'none' : 'block';
      } else {
        // show small prompt to add quickly (if not admin)
        const name = prompt('Tên addon (nhập để test, sẽ chỉ lưu tạm trên trang):');
        if(!name) return;
        const desc = prompt('Mô tả ngắn:') || '';
        const image = prompt('Link image (url) (tạm):') || '';
        const dl = prompt('Link tải (url)') || '#';
        const item = { id:'a'+Date.now(), name, description:desc, image, download:dl, featured:false, createdAt:new Date().toISOString() };
        addons.unshift(item); applyFilters();
        alert('Đã thêm tạm trên trang.');
      }
    });

    /* ========== filters UI events ======== */
    q.addEventListener('input', ()=> applyFilters());
    filterInput.addEventListener('input', ()=> applyFilters());
    sortEl.addEventListener('change', ()=> applyFilters());
    filterButtons.forEach(b=>{
      b.addEventListener('click', ()=>{
        const f = b.getAttribute('data-filter');
        if(f==='all'){ filterInput.value=''; q.value=''; }
        if(f==='featured'){ filterInput.value=''; q.value=''; /* highlight featured */ filtered = addons.filter(x=>x.featured); render(filtered); return; }
        if(f==='recent'){ filterInput.value=''; q.value=''; sortEl.value='new'; applyFilters(); return; }
        applyFilters();
      });
    });

    /* ========== init ========= */
    load();

    /* Optional: auto-refresh every N mins (disabled by default)
    setInterval(()=> load(), 1000 * 60 * 10);
    */

  </script>
</body>
</html>
